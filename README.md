
# Advertising Analyzer

Advertising Analyzer — это веб-приложение для анализа качества рекламных видеороликов. Оно позволяет загружать видеофайлы, анализировать рекламу (положение, размер, контрастность, длительность) и генерировать текстовый отчёт. Проект состоит из фронтенда (Vue.js) и бэкенда (FastAPI), работающих в Docker-контейнерах.

## Основные функции

* **Загрузка видео** : Поддержка перетаскивания (drag-and-drop) или выбора файла (максимум 500 МБ, формат MP4).
* **Просмотр истории загрузки видео** : Возмжность посмотреть свою историю загрузок видеофайлов в боковой панели.
* **Анализ рекламы** : Оценка положения, размера, контрастности и длительности рекламы с рекомендациями.
* **Отчёт** : Генерация текстового отчёта с отображением имени загруженного файла.
* **Визуальная обратная связь** : Зона загрузки становится зелёной после успешного анализа (после удаления файла).
* **Логи** : Подробные логи на фронтенде (в консоли и localStorage) и бэкенде (в файлах).

## Технологии

* **Фронтенд** :
* Vue.js 3
* Vite
* Tailwind CSS
* Axios (с повторными попытками)
* **Бэкенд** :
* FastAPI
* Python (OpenCV, NumPy, SciPy, YOLO для детекции)
* FFmpeg (для обработки видео)
* Poetry (для управления зависимостями)
* **Контейнеризация** :
* Docker и Docker Compose

## Структура проекта

```
advertising-analyzer/
├── backend/
│   ├── Dockerfile                  # Docker для бэкенда
│   ├── logs/
│   │   └── ad_quality.log          # Логи анализа
│   ├── poetry.lock                 # Зависимости Poetry
│   ├── pyproject.toml              # Конфигурация Poetry
│   ├── src/
│   │   ├── analyzer/               # Логика анализа рекламы
│   │   ├── api/                    # Эндпоинты FastAPI
│   │   ├── detector/               # Детекция объектов с YOLO
│   │   └── utils/                  # Утилиты (логирование и др.)
│   └── tests/                      # Тесты для бэкенда
├── debug_frames/                   # Кадры для отладки анализа
│   ├── frame_0000.jpg
│   ├── ...
│   ├── group_0.jpg
│   └── group_1.jpg
├── docker-compose.yml              # Конфигурация Docker Compose
├── frontend/
│   ├── Dockerfile                  # Docker для фронтенда
│   ├── index.html                  # Главная HTML-страница
│   ├── package.json                # Зависимости Node.js
│   ├── package-lock.json           # Лок зависимостей
│   ├── postcss.config.js           # Конфигурация PostCSS
│   ├── public/                     # Статические файлы
│   ├── src/
│   │   ├── App.vue                 # Главный компонент Vue
│   │   ├── components/
│   │   │   └── UploadVideo.vue     # Компонент для загрузки и анализа
│   │   ├── main.js                 # Точка входа Vue
│   │   └── style.css               # Глобальные стили
│   ├── tailwind.config.js          # Конфигурация Tailwind CSS
│   └── vite.config.js              # Конфигурация Vite
├── logs/
│   ├── ad_quality/                 # Папка для логов анализа
│   └── ad_quality.log              # Основной лог анализа
├── predictions/                    # JSON-файлы с предсказаниями YOLO
│   ├── <uuid>_predictions.json
│   └── ...
├── reports/                        # Текстовые отчёты анализа
│   ├── <uuid>_report.txt
│   └── ...
├── videos/                         # Загруженные видео
│   ├── <uuid>.mp4
│   └── ...
```

## Требования

* **Docker** и **Docker Compose** (для контейнеризации)
* **Node.js** (если запускаете фронтенд локально, версия ≥ 16)
* **Python** (если запускаете бэкенд локально, версия ≥ 3.8)
* **Poetry** (для управления зависимостями бэкенда)
* **FFmpeg** (для обработки видео на бэкенде)
* Модель YOLO (**best.pt**) в **backend/src/detector/models/**

## Установка

1. **Клонируйте репозиторий** :

```bash
   git clone https://github.com/Corner324/advertising-analyzer.git
   cd advertising-analyzer
```



2. **Убедитесь, что модель YOLO доступна** :

* По необходимости поместите файл **best.pt** в **backend/src/detector/models/**.
* Если модели нет, обратитесь к документации YOLO или обучите свою модель.

3. **Соберите и запустите контейнеры** :

```bash
   docker-compose up --build
```

   Это установит зависимости, соберёт образы и запустит фронтенд (на **http://localhost:8080**) и бэкенд (на **http://localhost:8000**).

## Использование

1. **Откройте приложение** :

* Перейдите по адресу **http://localhost:8080** в браузере.

2. **Загрузите видео** :

* Перетащите MP4-файл (до 500 МБ) в зону drag-and-drop или нажмите "Выберите файл".
* Поддерживаются только видео в формате MP4 с кодеком H.264.

3. **Анализируйте видео** :

* Нажмите "Анализировать видео".
* Дождитесь завершения загрузки и обработки (прогресс отображается в процентах).

4. **Просмотрите отчёт** :

* После анализа появится отчёт с оценкой рекламы (положение, размер, контрастность, длительность, рекомендации).
* Кнопка "Сохранить в PDF" неактивна (функциональность в разработке).

5. **Очистка** :

* Нажмите на крестик рядом с именем файла, чтобы удалить видео и начать заново.
* Зона drag-and-drop станет зелёной после успешного анализа.

## Отладка

### Логи

* **Фронтенд** :
* Откройте консоль браузера (F12 → Console).
* Логи сохраняются в **localStorage**:
  ```javascript
  console.log(JSON.parse(localStorage.getItem('appLogs')));
  ```
* Проверьте контейнер:
  ```bash
  docker-compose logs frontend
  ```
* **Бэкенд** :
* Логи анализа: **logs/ad_quality.log** или **backend/logs/ad_quality.log**
* Проверьте контейнер:
  ```bash
  docker-compose logs backend
  ```

### Типичные ошибки

* **"Сервер недоступен"** :
* Убедитесь, что бэкенд работает:

  ```bash
  curl http://localhost:8000/api/health
  ```

  Ожидаемый ответ: **{"status": "healthy"}**.
* Проверьте **docker-compose.yml** и настройки прокси в **frontend/vite.config.js**.
* **"Файл слишком большой"** :
* Видео должно быть ≤ 500 МБ. Сожмите видео с помощью FFmpeg:

  ```bash
  ffmpeg -i input.mp4 -vcodec libx264 -crf 23 -preset fast output.mp4
  ```
* **Ошибки декодирования видео** :
* Убедитесь, что видео в формате MP4 (H.264):

  ```bash
  ffprobe input.mp4
  ```
* Конвертируйте видео, если нужно:

  ```bash
  ffmpeg -i input.mp4 -c:v libx264 -c:a aac -strict -2 output.mp4
  ```

### Очистка

* Удалите контейнеры и образы:
  ```bash
  docker-compose down
  docker system prune -f
  ```
* Очистите зависимости фронтенда:
  ```bash
  cd frontend
  npm run clean
  npm install
  ```
* Очистите зависимости бэкенда:
  ```bash
  cd backend
  poetry install
  ```

## Разработка

### Фронтенд

* Запустите фронтенд локально:
  ```bash
  cd frontend
  npm install
  npm run dev
  ```
* Основной компонент: **frontend/src/components/UploadVideo.vue**.

### Бэкенд

* Установите зависимости:
  ```bash
  cd backend
  poetry install
  ```
* Запустите FastAPI:
  ```bash
  poetry run uvicorn src.api.main:app --host 0.0.0.0 --port 8000
  ```
* Основные модули:
  * **backend/src/api/main.py**: FastAPI приложение.
  * **backend/src/analyzer/**: Логика анализа рекламы.
  * **backend/src/detector/**: Детекция объектов с YOLO.

## Конфигурация

* **Порты** :
* Фронтенд: **8080** (измените в **docker-compose.yml**).
* Бэкенд: **8000** (измените в **docker-compose.yml**).
* **Прокси** :
* Настроен в **frontend/vite.config.js** для маршрутов **/api**.
* **Логирование** :
* Уровень логов можно изменить в **backend/src/utils/** (например, с **INFO** на **WARNING**).

## Ограничения

* Поддерживаются только MP4-видео с кодеком H.264.
* Максимальный размер файла: 500 МБ.
* Модель YOLO (**best.pt**) должна быть в **backend/src/detector/models/**.
* Обработка видео может занять до 1 минуты в зависимости от длины и производительности сервера.
* Функция сохранения отчёта в PDF не реализована (кнопка неактивна).

